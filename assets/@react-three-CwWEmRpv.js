import{W as nt,R as rt,O as ot,P as it,S as st,a as pe,V as at,b as ct,B as lt,C as ut,L as ft,c as ze,N as pt,A as dt,d as Re,e as vt,f as ht,U as bt,g as oe,h as mt,i as gt,T as yt}from"./three-GWCIwW1R.js";import{r as H,j as U}from"./react-CcQ_o4F1.js";import{c as ie,R as jt}from"./react-reconciler-DvZWWqlH.js";import{c as wt}from"./zustand-VKI-sGQK.js";import{c as Ct,x as Pt,i as St,m as Et}from"./its-fine-BCbS8qio.js";import{j as Mt}from"./react-use-measure-C3OIf4st.js";function bn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var de={exports:{}},ve={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oe;function _t(){return Oe||(Oe=1,function(e){function t(u,g){var m=u.length;u.push(g);e:for(;0<m;){var M=m-1>>>1,F=u[M];if(0<o(F,g))u[M]=g,u[m]=F,m=M;else break e}}function n(u){return u.length===0?null:u[0]}function r(u){if(u.length===0)return null;var g=u[0],m=u.pop();if(m!==g){u[0]=m;e:for(var M=0,F=u.length,S=F>>>1;M<S;){var R=2*(M+1)-1,z=u[R],x=R+1,X=u[x];if(0>o(z,m))x<F&&0>o(X,z)?(u[M]=X,u[x]=m,M=x):(u[M]=z,u[R]=m,M=R);else if(x<F&&0>o(X,m))u[M]=X,u[x]=m,M=x;else break e}}return g}function o(u,g){var m=u.sortIndex-g.sortIndex;return m!==0?m:u.id-g.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var h=Date,f=h.now();e.unstable_now=function(){return h.now()-f}}var i=[],d=[],l=1,c=null,v=3,b=!1,_=!1,O=!1,A=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,s=typeof setImmediate<"u"?setImmediate:null;function y(u){for(var g=n(d);g!==null;){if(g.callback===null)r(d);else if(g.startTime<=u)r(d),g.sortIndex=g.expirationTime,t(i,g);else break;g=n(d)}}function P(u){if(O=!1,y(u),!_)if(n(i)!==null)_=!0,I();else{var g=n(d);g!==null&&q(P,g.startTime-u)}}var C=!1,w=-1,L=5,N=-1;function E(){return!(e.unstable_now()-N<L)}function k(){if(C){var u=e.unstable_now();N=u;var g=!0;try{e:{_=!1,O&&(O=!1,p(w),w=-1),b=!0;var m=v;try{t:{for(y(u),c=n(i);c!==null&&!(c.expirationTime>u&&E());){var M=c.callback;if(typeof M=="function"){c.callback=null,v=c.priorityLevel;var F=M(c.expirationTime<=u);if(u=e.unstable_now(),typeof F=="function"){c.callback=F,y(u),g=!0;break t}c===n(i)&&r(i),y(u)}else r(i);c=n(i)}if(c!==null)g=!0;else{var S=n(d);S!==null&&q(P,S.startTime-u),g=!1}}break e}finally{c=null,v=m,b=!1}g=void 0}}finally{g?T():C=!1}}}var T;if(typeof s=="function")T=function(){s(k)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,j=V.port2;V.port1.onmessage=k,T=function(){j.postMessage(null)}}else T=function(){A(k,0)};function I(){C||(C=!0,T())}function q(u,g){w=A(function(){u(e.unstable_now())},g)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(u){u.callback=null},e.unstable_continueExecution=function(){_||b||(_=!0,I())},e.unstable_forceFrameRate=function(u){0>u||125<u?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<u?Math.floor(1e3/u):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_getFirstCallbackNode=function(){return n(i)},e.unstable_next=function(u){switch(v){case 1:case 2:case 3:var g=3;break;default:g=v}var m=v;v=g;try{return u()}finally{v=m}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(u,g){switch(u){case 1:case 2:case 3:case 4:case 5:break;default:u=3}var m=v;v=u;try{return g()}finally{v=m}},e.unstable_scheduleCallback=function(u,g,m){var M=e.unstable_now();switch(typeof m=="object"&&m!==null?(m=m.delay,m=typeof m=="number"&&0<m?M+m:M):m=M,u){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=m+F,u={id:l++,callback:g,priorityLevel:u,startTime:m,expirationTime:F,sortIndex:-1},m>M?(u.sortIndex=m,t(d,u),n(i)===null&&u===n(d)&&(O?(p(w),w=-1):O=!0,q(P,m-M))):(u.sortIndex=F,t(i,u),_||b||(_=!0,I())),u},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(u){var g=v;return function(){var m=v;v=g;try{return u.apply(this,arguments)}finally{v=m}}}}(ve)),ve}var Ie;function Tt(){return Ie||(Ie=1,de.exports=_t()),de.exports}var xe=Tt();function Be(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const Ue=e=>e&&e.isOrthographicCamera,kt=e=>e&&e.hasOwnProperty("current"),Rt=e=>e!=null&&(typeof e=="string"||typeof e=="number"||e.isColor),te=((e,t)=>typeof window<"u"&&(((e=window.document)==null?void 0:e.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?H.useLayoutEffect:H.useEffect;function Ve(e){const t=H.useRef(e);return te(()=>void(t.current=e),[e]),t}function Ot(){const e=Ct(),t=Pt();return H.useMemo(()=>({children:n})=>{const o=!!St(e,!0,a=>a.type===H.StrictMode)?H.StrictMode:H.Fragment;return U.jsx(o,{children:U.jsx(t,{children:n})})},[e,t])}function It({set:e}){return te(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}const xt=(e=>(e=class extends H.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}},e.getDerivedStateFromError=()=>({error:!0}),e))();function Xe(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function Y(e){var t;return(t=e.__r3f)==null?void 0:t.root.getState()}const D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,nul:e=>e===null,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e)||D.boo(e))return e===t;const a=D.obj(e);if(a&&r==="reference")return e===t;const h=D.arr(e);if(h&&n==="reference")return e===t;if((h||a)&&e===t)return!0;let f;for(f in e)if(!(f in t))return!1;if(a&&n==="shallow"&&r==="shallow"){for(f in o?t:e)if(!D.equ(e[f],t[f],{strict:o,objects:"reference"}))return!1}else for(f in o?t:e)if(e[f]!==t[f])return!1;if(D.und(f)){if(h&&e.length===0&&t.length===0||a&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function At(e){e.type!=="Scene"&&(e.dispose==null||e.dispose());for(const t in e){const n=e[t];n?.type!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const Ge=["children","key","ref"];function Ft(e){const t={};for(const n in e)Ge.includes(n)||(t[n]=e[n]);return t}function ae(e,t,n,r){const o=e;let a=o?.__r3f;return a||(a={root:t,type:n,parent:null,children:[],props:Ft(r),object:o,eventCount:0,handlers:{},isHidden:!1},o&&(o.__r3f=a)),a}function ee(e,t){let n=e[t];if(!t.includes("-"))return{root:e,key:t,target:n};n=e;for(const o of t.split("-")){var r;t=o,e=n,n=(r=n)==null?void 0:r[t]}return{root:e,key:t,target:n}}const Ae=/-\d+$/;function ce(e,t){if(D.str(t.props.attach)){if(Ae.test(t.props.attach)){const o=t.props.attach.replace(Ae,""),{root:a,key:h}=ee(e.object,o);Array.isArray(a[h])||(a[h]=[])}const{root:n,key:r}=ee(e.object,t.props.attach);t.previousAttach=n[r],n[r]=t.object}else D.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function le(e,t){if(D.str(t.props.attach)){const{root:n,key:r}=ee(e.object,t.props.attach),o=t.previousAttach;o===void 0?delete n[r]:n[r]=o}else t.previousAttach==null||t.previousAttach(e.object,t.object);delete t.previousAttach}const Ce=[...Ge,"args","dispose","attach","object","onUpdate","dispose"],Fe=new Map;function Dt(e){let t=Fe.get(e.constructor);try{t||(t=new e.constructor,Fe.set(e.constructor,t))}catch{}return t}function Ht(e,t){const n={};for(const r in t)if(!Ce.includes(r)&&!D.equ(t[r],e.props[r])){n[r]=t[r];for(const o in t)o.startsWith(`${r}-`)&&(n[o]=t[o])}for(const r in e.props){if(Ce.includes(r)||t.hasOwnProperty(r))continue;const{root:o,key:a}=ee(e.object,r);if(o.constructor&&o.constructor.length===0){const h=Dt(o);D.und(h)||(n[a]=h[a])}else n[a]=0}return n}const Lt=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Nt=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function G(e,t){var n;const r=e.__r3f,o=r&&Be(r).getState(),a=r?.eventCount;for(const f in t){let i=t[f];if(Ce.includes(f))continue;if(r&&Nt.test(f)){typeof i=="function"?r.handlers[f]=i:delete r.handlers[f],r.eventCount=Object.keys(r.handlers).length;continue}if(i===void 0)continue;let{root:d,key:l,target:c}=ee(e,f);if(c instanceof Re&&i instanceof Re)c.mask=i.mask;else if(c instanceof vt&&Rt(i))c.set(i);else if(c!==null&&typeof c=="object"&&typeof c.set=="function"&&typeof c.copy=="function"&&i!=null&&i.constructor&&c.constructor===i.constructor)c.copy(i);else if(c!==null&&typeof c=="object"&&typeof c.set=="function"&&Array.isArray(i))typeof c.fromArray=="function"?c.fromArray(i):c.set(...i);else if(c!==null&&typeof c=="object"&&typeof c.set=="function"&&typeof i=="number")typeof c.setScalar=="function"?c.setScalar(i):c.set(i);else{var h;d[l]=i,o&&!o.linear&&Lt.includes(l)&&(h=d[l])!=null&&h.isTexture&&d[l].format===ht&&d[l].type===bt&&(d[l].colorSpace=ze)}}if(r!=null&&r.parent&&o!=null&&o.internal&&(n=r.object)!=null&&n.isObject3D&&a!==r.eventCount){const f=r.object,i=o.internal.interaction.indexOf(f);i>-1&&o.internal.interaction.splice(i,1),r.eventCount&&f.raycast!==null&&o.internal.interaction.push(f)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&K(r),e}function K(e){var t;if(!e.parent)return;e.props.onUpdate==null||e.props.onUpdate(e.object);const n=(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function qt(e,t){e.manual||(Ue(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}const B=e=>e?.isObject3D;function ne(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function We(e,t,n,r){const o=n.get(t);o&&(n.delete(t),n.size===0&&(e.delete(r),o.target.releasePointerCapture(r)))}function zt(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(r=>r!==t),n.initialHits=n.initialHits.filter(r=>r!==t),n.hovered.forEach((r,o)=>{(r.eventObject===t||r.object===t)&&n.hovered.delete(o)}),n.capturedMap.forEach((r,o)=>{We(n.capturedMap,t,r,o)})}function Bt(e){function t(i){const{internal:d}=e.getState(),l=i.offsetX-d.initialClick[0],c=i.offsetY-d.initialClick[1];return Math.round(Math.sqrt(l*l+c*c))}function n(i){return i.filter(d=>["Move","Over","Enter","Out","Leave"].some(l=>{var c;return(c=d.__r3f)==null?void 0:c.handlers["onPointer"+l]}))}function r(i,d){const l=e.getState(),c=new Set,v=[],b=d?d(l.internal.interaction):l.internal.interaction;for(let p=0;p<b.length;p++){const s=Y(b[p]);s&&(s.raycaster.camera=void 0)}l.previousRoot||l.events.compute==null||l.events.compute(i,l);function _(p){const s=Y(p);if(!s||!s.events.enabled||s.raycaster.camera===null)return[];if(s.raycaster.camera===void 0){var y;s.events.compute==null||s.events.compute(i,s,(y=s.previousRoot)==null?void 0:y.getState()),s.raycaster.camera===void 0&&(s.raycaster.camera=null)}return s.raycaster.camera?s.raycaster.intersectObject(p,!0):[]}let O=b.flatMap(_).sort((p,s)=>{const y=Y(p.object),P=Y(s.object);return!y||!P?p.distance-s.distance:P.events.priority-y.events.priority||p.distance-s.distance}).filter(p=>{const s=ne(p);return c.has(s)?!1:(c.add(s),!0)});l.events.filter&&(O=l.events.filter(O,l));for(const p of O){let s=p.object;for(;s;){var A;(A=s.__r3f)!=null&&A.eventCount&&v.push({...p,eventObject:s}),s=s.parent}}if("pointerId"in i&&l.internal.capturedMap.has(i.pointerId))for(let p of l.internal.capturedMap.get(i.pointerId).values())c.has(ne(p.intersection))||v.push(p.intersection);return v}function o(i,d,l,c){if(i.length){const v={stopped:!1};for(const b of i){let _=Y(b.object);if(_||b.object.traverseAncestors(O=>{const A=Y(O);if(A)return _=A,!1}),_){const{raycaster:O,pointer:A,camera:p,internal:s}=_,y=new oe(A.x,A.y,0).unproject(p),P=E=>{var k,T;return(k=(T=s.capturedMap.get(E))==null?void 0:T.has(b.eventObject))!=null?k:!1},C=E=>{const k={intersection:b,target:d.target};s.capturedMap.has(E)?s.capturedMap.get(E).set(b.eventObject,k):s.capturedMap.set(E,new Map([[b.eventObject,k]])),d.target.setPointerCapture(E)},w=E=>{const k=s.capturedMap.get(E);k&&We(s.capturedMap,b.eventObject,k,E)};let L={};for(let E in d){let k=d[E];typeof k!="function"&&(L[E]=k)}let N={...b,...L,pointer:A,intersections:i,stopped:v.stopped,delta:l,unprojectedPoint:y,ray:O.ray,camera:p,stopPropagation(){const E="pointerId"in d&&s.capturedMap.get(d.pointerId);if((!E||E.has(b.eventObject))&&(N.stopped=v.stopped=!0,s.hovered.size&&Array.from(s.hovered.values()).find(k=>k.eventObject===b.eventObject))){const k=i.slice(0,i.indexOf(b));a([...k,b])}},target:{hasPointerCapture:P,setPointerCapture:C,releasePointerCapture:w},currentTarget:{hasPointerCapture:P,setPointerCapture:C,releasePointerCapture:w},nativeEvent:d};if(c(N),v.stopped===!0)break}}}return i}function a(i){const{internal:d}=e.getState();for(const l of d.hovered.values())if(!i.length||!i.find(c=>c.object===l.object&&c.index===l.index&&c.instanceId===l.instanceId)){const v=l.eventObject.__r3f;if(d.hovered.delete(ne(l)),v!=null&&v.eventCount){const b=v.handlers,_={...l,intersections:i};b.onPointerOut==null||b.onPointerOut(_),b.onPointerLeave==null||b.onPointerLeave(_)}}}function h(i,d){for(let l=0;l<d.length;l++){const c=d[l].__r3f;c==null||c.handlers.onPointerMissed==null||c.handlers.onPointerMissed(i)}}function f(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return d=>{const{internal:l}=e.getState();"pointerId"in d&&l.capturedMap.has(d.pointerId)&&requestAnimationFrame(()=>{l.capturedMap.has(d.pointerId)&&(l.capturedMap.delete(d.pointerId),a([]))})}}return function(l){const{onPointerMissed:c,internal:v}=e.getState();v.lastEvent.current=l;const b=i==="onPointerMove",_=i==="onClick"||i==="onContextMenu"||i==="onDoubleClick",A=r(l,b?n:void 0),p=_?t(l):0;i==="onPointerDown"&&(v.initialClick=[l.offsetX,l.offsetY],v.initialHits=A.map(y=>y.eventObject)),_&&!A.length&&p<=2&&(h(l,v.interaction),c&&c(l)),b&&a(A);function s(y){const P=y.eventObject,C=P.__r3f;if(!(C!=null&&C.eventCount))return;const w=C.handlers;if(b){if(w.onPointerOver||w.onPointerEnter||w.onPointerOut||w.onPointerLeave){const L=ne(y),N=v.hovered.get(L);N?N.stopped&&y.stopPropagation():(v.hovered.set(L,y),w.onPointerOver==null||w.onPointerOver(y),w.onPointerEnter==null||w.onPointerEnter(y))}w.onPointerMove==null||w.onPointerMove(y)}else{const L=w[i];L?(!_||v.initialHits.includes(P))&&(h(l,v.interaction.filter(N=>!v.initialHits.includes(N))),L(y)):_&&v.initialHits.includes(P)&&h(l,v.interaction.filter(N=>!v.initialHits.includes(N)))}}o(A,l,p,s)}}return{handlePointer:f}}const De=e=>!!(e!=null&&e.render),Ye=H.createContext(null),Ut=(e,t)=>{const n=wt((f,i)=>{const d=new oe,l=new oe,c=new oe;function v(p=i().camera,s=l,y=i().size){const{width:P,height:C,top:w,left:L}=y,N=P/C;s.isVector3?c.copy(s):c.set(...s);const E=p.getWorldPosition(d).distanceTo(c);if(Ue(p))return{width:P/p.zoom,height:C/p.zoom,top:w,left:L,factor:1,distance:E,aspect:N};{const k=p.fov*Math.PI/180,T=2*Math.tan(k/2)*E,V=T*(P/C);return{width:V,height:T,top:w,left:L,factor:P/V,distance:E,aspect:N}}}let b;const _=p=>f(s=>({performance:{...s.performance,current:p}})),O=new mt;return{set:f,get:i,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(p=1)=>e(i(),p),advance:(p,s)=>t(p,s,i()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new gt,pointer:O,mouse:O,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const p=i();b&&clearTimeout(b),p.performance.current!==p.performance.min&&_(p.performance.min),b=setTimeout(()=>_(i().performance.max),p.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:p=>f(s=>({...s,events:{...s.events,...p}})),setSize:(p,s,y=0,P=0)=>{const C=i().camera,w={width:p,height:s,top:y,left:P};f(L=>({size:w,viewport:{...L.viewport,...v(C,l,w)}}))},setDpr:p=>f(s=>{const y=Xe(p);return{viewport:{...s.viewport,dpr:y,initialDpr:s.viewport.initialDpr||y}}}),setFrameloop:(p="always")=>{const s=i().clock;s.stop(),s.elapsedTime=0,p!=="never"&&(s.start(),s.elapsedTime=0),f(()=>({frameloop:p}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:H.createRef(),active:!1,frames:0,priority:0,subscribe:(p,s,y)=>{const P=i().internal;return P.priority=P.priority+(s>0?1:0),P.subscribers.push({ref:p,priority:s,store:y}),P.subscribers=P.subscribers.sort((C,w)=>C.priority-w.priority),()=>{const C=i().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(s>0?1:0),C.subscribers=C.subscribers.filter(w=>w.ref!==p))}}}}}),r=n.getState();let o=r.size,a=r.viewport.dpr,h=r.camera;return n.subscribe(()=>{const{camera:f,size:i,viewport:d,gl:l,set:c}=n.getState();if(i.width!==o.width||i.height!==o.height||d.dpr!==a){o=i,a=d.dpr,qt(f,i),d.dpr>0&&l.setPixelRatio(d.dpr);const v=typeof HTMLCanvasElement<"u"&&l.domElement instanceof HTMLCanvasElement;l.setSize(i.width,i.height,v)}f!==h&&(h=f,c(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(f)}})))}),n.subscribe(f=>e(f)),n};function Qe(){const e=H.useContext(Ye);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function gn(e=n=>n,t){return Qe()(e,t)}function yn(e,t=0){const n=Qe(),r=n.getState().internal.subscribe,o=Ve(e);return te(()=>r(o,t,n),[t,r,n]),null}function Vt(e){const t=jt(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:H.version}),t}const Ze=0,J={},Xt=/^three(?=[A-Z])/,fe=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let Gt=0;const Wt=e=>typeof e=="function";function Yt(e){if(Wt(e)){const t=`${Gt++}`;return J[t]=e,t}else Object.assign(J,e)}function Je(e,t){const n=fe(e),r=J[n];if(e!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(e==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function Qt(e,t,n){var r;return e=fe(e)in J?e:e.replace(Xt,""),Je(e,t),e==="primitive"&&(r=t.object)!=null&&r.__r3f&&delete t.object.__r3f,ae(t.object,n,e,t)}function Zt(e){if(!e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?le(e.parent,e):B(e.object)&&(e.object.visible=!1),e.isHidden=!0,K(e)}}function Ke(e){if(e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?ce(e.parent,e):B(e.object)&&e.props.visible!==!1&&(e.object.visible=!0),e.isHidden=!1,K(e)}}function Te(e,t,n){const r=t.root.getState();if(!(!e.parent&&e.object!==r.scene)){if(!t.object){var o,a;const h=J[fe(t.type)];t.object=(o=t.props.object)!=null?o:new h(...(a=t.props.args)!=null?a:[]),t.object.__r3f=t}if(G(t.object,t.props),t.props.attach)ce(e,t);else if(B(t.object)&&B(e.object)){const h=e.object.children.indexOf(n?.object);if(n&&h!==-1){const f=e.object.children.indexOf(t.object);if(f!==-1){e.object.children.splice(f,1);const i=f<h?h-1:h;e.object.children.splice(i,0,t.object)}else t.object.parent=e.object,e.object.children.splice(h,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const h of t.children)Te(t,h);K(t)}}function he(e,t){t&&(t.parent=e,e.children.push(t),Te(e,t))}function He(e,t,n){if(!t||!n)return;t.parent=e;const r=e.children.indexOf(n);r!==-1?e.children.splice(r,0,t):e.children.push(t),Te(e,t,n)}function $e(e){if(typeof e.dispose=="function"){const t=()=>{try{e.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?t():xe.unstable_scheduleCallback(xe.unstable_IdlePriority,t)}}function Pe(e,t,n){if(!t)return;t.parent=null;const r=e.children.indexOf(t);r!==-1&&e.children.splice(r,1),t.props.attach?le(e,t):B(t.object)&&B(e.object)&&(e.object.remove(t.object),zt(Be(t),t.object));const o=t.props.dispose!==null&&n!==!1;for(let a=t.children.length-1;a>=0;a--){const h=t.children[a];Pe(t,h,o)}t.children.length=0,delete t.object.__r3f,o&&t.type!=="primitive"&&t.object.type!=="Scene"&&$e(t.object),n===void 0&&K(t)}function Jt(e,t){for(const n of[e,e.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(t);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=t)}const se=[];function Kt(){for(const[n]of se){const r=n.parent;if(r){n.props.attach?le(r,n):B(n.object)&&B(r.object)&&r.object.remove(n.object);for(const o of n.children)o.props.attach?le(n,o):B(o.object)&&B(n.object)&&n.object.remove(o.object)}n.isHidden&&Ke(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&$e(n.object)}for(const[n,r,o]of se){n.props=r;const a=n.parent;if(a){var e,t;const h=J[fe(n.type)];n.object=(e=n.props.object)!=null?e:new h(...(t=n.props.args)!=null?t:[]),n.object.__r3f=n,Jt(o,n.object),G(n.object,n.props),n.props.attach?ce(a,n):B(n.object)&&B(a.object)&&a.object.add(n.object);for(const f of n.children)f.props.attach?ce(n,f):B(f.object)&&B(n.object)&&n.object.add(f.object);K(n)}}se.length=0}const be=()=>{},Le={};let re=Ze;const $t=0,en=4,Se=Vt({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:Qt,removeChild:Pe,appendChild:he,appendInitialChild:he,insertBefore:He,appendChildToContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||he(n,t)},removeChildFromContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||Pe(n,t)},insertInContainerBefore(e,t,n){const r=e.getState().scene.__r3f;!t||!n||!r||He(r,t,n)},getRootHostContext:()=>Le,getChildHostContext:()=>Le,commitUpdate(e,t,n,r,o){var a,h,f;Je(t,r);let i=!1;if((e.type==="primitive"&&n.object!==r.object||((a=r.args)==null?void 0:a.length)!==((h=n.args)==null?void 0:h.length)||(f=r.args)!=null&&f.some((l,c)=>{var v;return l!==((v=n.args)==null?void 0:v[c])}))&&(i=!0),i)se.push([e,{...r},o]);else{const l=Ht(e,r);Object.keys(l).length&&(Object.assign(e.props,l),G(e.object,l))}(o.sibling===null||(o.flags&en)===$t)&&Kt()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>e?.object,prepareForCommit:()=>null,preparePortalMount:e=>ae(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:Zt,unhideInstance:Ke,createTextInstance:be,hideTextInstance:be,unhideTextInstance:be,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:H.createContext(null),setCurrentUpdatePriority(e){re=e},getCurrentUpdatePriority(){return re},resolveUpdatePriority(){var e;if(re!==Ze)return re;switch(typeof window<"u"&&((e=window.event)==null?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ie.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ie.ContinuousEventPriority;default:return ie.DefaultEventPriority}},resetFormInstance(){}}),W=new Map,Q={objects:"shallow",strict:!1};function tn(e,t){if(!t&&typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:r,top:o,left:a}=e.parentElement.getBoundingClientRect();return{width:n,height:r,top:o,left:a}}else if(!t&&typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function nn(e){const t=W.get(e),n=t?.fiber,r=t?.store;t&&console.warn("R3F.createRoot should only be called once!");const o=typeof reportError=="function"?reportError:console.error,a=r||Ut(_e,qe),h=n||Se.createContainer(a,ie.ConcurrentRoot,null,!1,null,"",o,o,o,null);t||W.set(e,{fiber:h,store:a});let f,i,d=!1,l=null;return{async configure(c={}){let v;l=new Promise(S=>v=S);let{gl:b,size:_,scene:O,events:A,onCreated:p,shadows:s=!1,linear:y=!1,flat:P=!1,legacy:C=!1,orthographic:w=!1,frameloop:L="always",dpr:N=[1,2],performance:E,raycaster:k,camera:T,onPointerMissed:V}=c,j=a.getState(),I=j.gl;if(!j.gl){const S={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},R=typeof b=="function"?await b(S):b;De(R)?I=R:I=new nt({...S,...b}),j.set({gl:I})}let q=j.raycaster;q||j.set({raycaster:q=new rt});const{params:u,...g}=k||{};if(D.equ(g,q,Q)||G(q,{...g}),D.equ(u,q.params,Q)||G(q,{params:{...q.params,...u}}),!j.camera||j.camera===i&&!D.equ(i,T,Q)){i=T;const S=T?.isCamera,R=S?T:w?new ot(0,0,0,0,.1,1e3):new it(75,0,.1,1e3);S||(R.position.z=5,T&&(G(R,T),R.manual||("aspect"in T||"left"in T||"right"in T||"bottom"in T||"top"in T)&&(R.manual=!0,R.updateProjectionMatrix())),!j.camera&&!(T!=null&&T.rotation)&&R.lookAt(0,0,0)),j.set({camera:R}),q.camera=R}if(!j.scene){let S;O!=null&&O.isScene?(S=O,ae(S,a,"",{})):(S=new st,ae(S,a,"",{}),O&&G(S,O)),j.set({scene:S})}A&&!j.events.handlers&&j.set({events:A(a)});const m=tn(e,_);if(D.equ(m,j.size,Q)||j.setSize(m.width,m.height,m.top,m.left),N&&j.viewport.dpr!==Xe(N)&&j.setDpr(N),j.frameloop!==L&&j.setFrameloop(L),j.onPointerMissed||j.set({onPointerMissed:V}),E&&!D.equ(E,j.performance,Q)&&j.set(S=>({performance:{...S.performance,...E}})),!j.xr){var M;const S=(x,X)=>{const ke=a.getState();ke.frameloop!=="never"&&qe(x,!0,ke,X)},R=()=>{const x=a.getState();x.gl.xr.enabled=x.gl.xr.isPresenting,x.gl.xr.setAnimationLoop(x.gl.xr.isPresenting?S:null),x.gl.xr.isPresenting||_e(x)},z={connect(){const x=a.getState().gl;x.xr.addEventListener("sessionstart",R),x.xr.addEventListener("sessionend",R)},disconnect(){const x=a.getState().gl;x.xr.removeEventListener("sessionstart",R),x.xr.removeEventListener("sessionend",R)}};typeof((M=I.xr)==null?void 0:M.addEventListener)=="function"&&z.connect(),j.set({xr:z})}if(I.shadowMap){const S=I.shadowMap.enabled,R=I.shadowMap.type;if(I.shadowMap.enabled=!!s,D.boo(s))I.shadowMap.type=pe;else if(D.str(s)){var F;const z={basic:lt,percentage:ct,soft:pe,variance:at};I.shadowMap.type=(F=z[s])!=null?F:pe}else D.obj(s)&&Object.assign(I.shadowMap,s);(S!==I.shadowMap.enabled||R!==I.shadowMap.type)&&(I.shadowMap.needsUpdate=!0)}return ut.enabled=!C,d||(I.outputColorSpace=y?ft:ze,I.toneMapping=P?pt:dt),j.legacy!==C&&j.set(()=>({legacy:C})),j.linear!==y&&j.set(()=>({linear:y})),j.flat!==P&&j.set(()=>({flat:P})),b&&!D.fun(b)&&!De(b)&&!D.equ(b,I,Q)&&G(I,b),f=p,d=!0,v(),this},render(c){return!d&&!l&&this.configure(),l.then(()=>{Se.updateContainer(U.jsx(rn,{store:a,children:c,onCreated:f,rootElement:e}),h,null,()=>{})}),a},unmount(){et(e)}}}function rn({store:e,children:t,onCreated:n,rootElement:r}){return te(()=>{const o=e.getState();o.set(a=>({internal:{...a.internal,active:!0}})),n&&n(o),e.getState().events.connected||o.events.connect==null||o.events.connect(r)},[]),U.jsx(Ye.Provider,{value:e,children:t})}function et(e,t){const n=W.get(e),r=n?.fiber;if(r){const o=n?.store.getState();o&&(o.internal.active=!1),Se.updateContainer(null,r,null,()=>{o&&setTimeout(()=>{try{var a,h,f,i;o.events.disconnect==null||o.events.disconnect(),(a=o.gl)==null||(h=a.renderLists)==null||h.dispose==null||h.dispose(),(f=o.gl)==null||f.forceContextLoss==null||f.forceContextLoss(),(i=o.gl)!=null&&i.xr&&o.xr.disconnect(),At(o.scene),W.delete(e)}catch{}},500)})}}const on=new Set,sn=new Set,an=new Set;function me(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function $(e,t){switch(e){case"before":return me(on,t);case"after":return me(sn,t);case"tail":return me(an,t)}}let ge,ye;function Ee(e,t,n){let r=t.clock.getDelta();t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ge=t.internal.subscribers;for(let o=0;o<ge.length;o++)ye=ge[o],ye.ref.current(ye.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let ue=!1,Me=!1,je,Ne,Z;function tt(e){Ne=requestAnimationFrame(tt),ue=!0,je=0,$("before",e),Me=!0;for(const n of W.values()){var t;Z=n.store.getState(),Z.internal.active&&(Z.frameloop==="always"||Z.internal.frames>0)&&!((t=Z.gl.xr)!=null&&t.isPresenting)&&(je+=Ee(e,Z))}if(Me=!1,$("after",e),je===0)return $("tail",e),ue=!1,cancelAnimationFrame(Ne)}function _e(e,t=1){var n;if(!e)return W.forEach(r=>_e(r.store.getState(),t));(n=e.gl.xr)!=null&&n.isPresenting||!e.internal.active||e.frameloop==="never"||(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):Me?e.internal.frames=2:e.internal.frames=1,ue||(ue=!0,requestAnimationFrame(tt)))}function qe(e,t=!0,n,r){if(t&&$("before",e),n)Ee(e,n,r);else for(const o of W.values())Ee(e,o.store.getState());t&&$("after",e)}const we={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function cn(e){const{handlePointer:t}=Bt(e);return{priority:1,enabled:!0,compute(n,r,o){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(we).reduce((n,r)=>({...n,[r]:t(r)}),{}),update:()=>{var n;const{events:r,internal:o}=e.getState();(n=o.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(o.lastEvent.current)},connect:n=>{const{set:r,events:o}=e.getState();if(o.disconnect==null||o.disconnect(),r(a=>({events:{...a.events,connected:n}})),o.handlers)for(const a in o.handlers){const h=o.handlers[a],[f,i]=we[a];n.addEventListener(f,h,{passive:i})}},disconnect:()=>{const{set:n,events:r}=e.getState();if(r.connected){if(r.handlers)for(const o in r.handlers){const a=r.handlers[o],[h]=we[o];r.connected.removeEventListener(h,a)}n(o=>({events:{...o.events,connected:void 0}}))}}}}function ln({ref:e,children:t,fallback:n,resize:r,style:o,gl:a,events:h=cn,eventSource:f,eventPrefix:i,shadows:d,linear:l,flat:c,legacy:v,orthographic:b,frameloop:_,dpr:O,performance:A,raycaster:p,camera:s,scene:y,onPointerMissed:P,onCreated:C,...w}){H.useMemo(()=>Yt(yt),[]);const L=Ot(),[N,E]=Mt({scroll:!0,debounce:{scroll:50,resize:0},...r}),k=H.useRef(null),T=H.useRef(null);H.useImperativeHandle(e,()=>k.current);const V=Ve(P),[j,I]=H.useState(!1),[q,u]=H.useState(!1);if(j)throw j;if(q)throw q;const g=H.useRef(null);te(()=>{const M=k.current;if(E.width>0&&E.height>0&&M){g.current||(g.current=nn(M));async function F(){await g.current.configure({gl:a,scene:y,events:h,shadows:d,linear:l,flat:c,legacy:v,orthographic:b,frameloop:_,dpr:O,performance:A,raycaster:p,camera:s,size:E,onPointerMissed:(...S)=>V.current==null?void 0:V.current(...S),onCreated:S=>{S.events.connect==null||S.events.connect(f?kt(f)?f.current:f:T.current),i&&S.setEvents({compute:(R,z)=>{const x=R[i+"X"],X=R[i+"Y"];z.pointer.set(x/z.size.width*2-1,-(X/z.size.height)*2+1),z.raycaster.setFromCamera(z.pointer,z.camera)}}),C?.(S)}}),g.current.render(U.jsx(L,{children:U.jsx(xt,{set:u,children:U.jsx(H.Suspense,{fallback:U.jsx(It,{set:I}),children:t??null})})}))}F()}}),H.useEffect(()=>{const M=k.current;if(M)return()=>et(M)},[]);const m=f?"none":"auto";return U.jsx("div",{ref:T,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:m,...o},...w,children:U.jsx("div",{ref:N,style:{width:"100%",height:"100%"},children:U.jsx("canvas",{ref:k,style:{display:"block"},children:n})})})}function jn(e){return U.jsx(Et,{children:U.jsx(ln,{...e})})}export{jn as C,yn as a,bn as g,gn as u};
